{% extends 'base.html' %}

{% block title %}Sistema de Controle de Qualidade - Vermiculita{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 mb-4">
        <div class="jumbotron bg-primary text-white p-5 rounded">
            <div class="container">
                <h1 class="display-4">
                    <i class="bi bi-gem"></i> Sistema de Controle de Qualidade
                </h1>
                <p class="lead">Mineração de Vermiculita - Controle de Qualidade Inteligente</p>
                <hr class="my-4 bg-white">
                <p>Sistema completo para controle de qualidade na mineração, com análises estatísticas, laudos automáticos e interface mobile-first.</p>
                <div class="mt-4">
                    <a class="btn btn-light btn-lg me-3" href="{% url 'quality_control:dashboard' %}" role="button">
                        <i class="bi bi-graph-up"></i> Dashboard
                    </a>
                    <a class="btn btn-outline-light btn-lg me-3" href="{% url 'core:mobile_home' %}" role="button">
                        <i class="bi bi-phone"></i> Interface Mobile
                    </a>
                    <a class="btn btn-outline-light btn-lg" href="{% url 'quality_control:spot_analysis_create' %}" role="button">
                        <i class="bi bi-plus-circle"></i> Nova Análise
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cards de Funcionalidades -->
<div class="row">
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card h-100 border-primary">
            <div class="card-body text-center">
                <i class="bi bi-clipboard-data text-primary fs-1 mb-3"></i>
                <h5 class="card-title">Análises Pontuais</h5>
                <p class="card-text">Registro de análises durante os turnos com validação automática contra especificações.</p>
                <a href="{% url 'quality_control:spot_analysis_create' %}" class="btn btn-primary">
                    <i class="bi bi-plus"></i> Nova Análise
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card h-100 border-success">
            <div class="card-body text-center">
                <i class="bi bi-graph-up text-success fs-1 mb-3"></i>
                <h5 class="card-title">Dashboard & SPC</h5>
                <p class="card-text">Dashboards em tempo real com cartas de controle estatístico e análises de capabilidade.</p>
                <a href="{% url 'quality_control:dashboard' %}" class="btn btn-success">
                    <i class="bi bi-eye"></i> Ver Dashboard
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card h-100 border-info">
            <div class="card-body text-center">
                <i class="bi bi-file-earmark-pdf text-info fs-1 mb-3"></i>
                <h5 class="card-title">Laudos & Ordens</h5>
                <p class="card-text">Geração automática de laudos de qualidade e ordens de carregamento com QR codes.</p>
                <a href="{% url 'quality_control:report_list' %}" class="btn btn-info">
                    <i class="bi bi-file-text"></i> Ver Laudos
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card h-100 border-warning">
            <div class="card-body text-center">
                <i class="bi bi-qr-code text-warning fs-1 mb-3"></i>
                <h5 class="card-title">QR Codes</h5>
                <p class="card-text">Acesso rápido às informações das linhas de produção via QR codes para dispositivos móveis.</p>
                <a href="{% url 'core:qr_code' 'L01' %}" class="btn btn-warning">
                    <i class="bi bi-qr-code"></i> Ver QR Codes
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Estatísticas Rápidas -->
<div class="row">
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-speedometer2"></i> Estatísticas do Sistema
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3 col-6 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-primary" id="totalAnalyses">-</h3>
                            <small class="text-muted">Total de Análises</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-success" id="totalReports">-</h3>
                            <small class="text-muted">Laudos Gerados</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-info" id="approvalRate">-</h3>
                            <small class="text-muted">Taxa de Aprovação</small>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="border rounded p-3">
                            <h3 class="text-warning" id="recentAnalyses">-</h3>
                            <small class="text-muted">Últimos 30 dias</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Acesso Rápido -->
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-lightning"></i> Acesso Rápido
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'quality_control:spot_analysis_create' %}" class="btn btn-outline-primary">
                        <i class="bi bi-plus-circle"></i> Nova Análise Pontual
                    </a>
                    <a href="{% url 'quality_control:control_chart' %}" class="btn btn-outline-success">
                        <i class="bi bi-graph-up"></i> Cartas de Controle
                    </a>
                    <a href="{% url 'core:data_export' %}" class="btn btn-outline-info">
                        <i class="bi bi-download"></i> Exportar Dados
                    </a>
                    <a href="{% url 'admin:index' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-gear"></i> Administração
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle"></i> Informações do Sistema
                </h6>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><strong>Versão:</strong></td>
                        <td>1.0.0</td>
                    </tr>
                    <tr>
                        <td><strong>Última Atualização:</strong></td>
                        <td>{{ "now"|date:"d/m/Y H:i" }}</td>
                    </tr>
                    <tr>
                        <td><strong>Usuário:</strong></td>
                        <td>{{ user.get_full_name|default:user.username }}</td>
                    </tr>
                    <tr>
                        <td><strong>Perfil:</strong></td>
                        <td>
                            {% if user.is_superuser %}
                                <span class="badge bg-danger">Administrador</span>
                            {% elif user.is_staff %}
                                <span class="badge bg-warning">Staff</span>
                            {% else %}
                                <span class="badge bg-primary">Usuário</span>
                            {% endif %}
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Carregar estatísticas
    document.addEventListener('DOMContentLoaded', function() {
        loadSystemStats();
        
        // Atualizar a cada 30 segundos
        setInterval(loadSystemStats, 30000);
    });
    
    function loadSystemStats() {
        fetch('/api/system-stats/')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalAnalyses').textContent = data.total_analyses.toLocaleString();
                document.getElementById('totalReports').textContent = data.total_reports.toLocaleString();
                document.getElementById('approvalRate').textContent = data.approval_rate.toFixed(1) + '%';
                document.getElementById('recentAnalyses').textContent = data.recent_analyses.toLocaleString();
            })
            .catch(error => {
                console.error('Erro ao carregar estatísticas:', error);
                // Valores padrão em caso de erro
                document.getElementById('totalAnalyses').textContent = '0';
                document.getElementById('totalReports').textContent = '0';
                document.getElementById('approvalRate').textContent = '0%';
                document.getElementById('recentAnalyses').textContent = '0';
            });
    }
    
    // Detectar dispositivo móvel e sugerir interface mobile
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        // Mostrar toast sugerindo interface mobile
        setTimeout(() => {
            if (confirm('Dispositivo móvel detectado! Deseja acessar a interface otimizada para celular?')) {
                window.location.href = '{% url "core:mobile_home" %}';
            }
        }, 2000);
    }
</script>

<style>
    .jumbotron {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    }
    
    .card {
        transition: transform 0.2s ease-in-out;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .border {
        border-color: #dee2e6 !important;
    }
    
    .border:hover {
        border-color: #007bff !important;
    }
</style>
{% endblock %}
